# 第九章：消息认证码

在密码学中，消息认证码（英语：Message authentication code，缩写为MAC），又译为消息鉴别码、文件消息认证码、讯息鉴别码、信息认证码，是经过特定算法后产生的一小段信息，检查某段消息的完整性，以及作身份验证。它可以用来检查在消息传递过程中，其内容是否被更改过，不管更改的原因是来自意外或是蓄意攻击。同时可以作为消息来源的身份验证，确认消息的来源。

### 一. 消息认证码简介

消息认证实际上是对消息本身产生一个冗余的信息-MAC消息认证码, 消息认证码是利用密钥对要认证的消息产生新的数据块并对数据块加密生成的。它对于要保护的信息来说是唯一和一一对应的。因此可以有效地保护消息的完整性。以及实现发送方消息的不可抵赖和不能伪造。

#### 1. MAC 函数

消息认证码(MAC)函数是消息和密钥的公开函数, 它产生定长的值, 以该值作为认证码。 MAC 函数有如下形式的定义:MAC = Ck(M), 其中Ｍ为一个变长消息, K是收发双方共享的密钥, C(k)M是定长的认证码。

##### 1.1.MAC 函数的安全性要求如下

- 攻击者已知 Ｍ 和 Ck(M), 则他构造满足 Ck(M1)=Ck(M)的消息 M1 在计算上是不可行的。
- Ck(M) 应是均匀分布的， 即对任何随机选择的消息 M 和 M1， Ck(M1)=Ck(M)的概率是 2^-n, 其中 n 是 MAC 的比特长度。
- 设 M1 是 M 的某个已知的变换, 即 M1=f(M). 例如: ｆ可表示逆转Ｍ的一位或多位， 那么 Ck(M1)=Ck(M) 的概率是2^-n。
 
第一个要求可以防止攻击者制造出和给定 MAC 匹配的新消息。 第二个要求是为了阻止基于选择明文的穷举攻击。 最后一条要求认证算法对消息的某部分或位不应比其它部分或位更弱。

目前的现状是，人们比较喜欢使用 Hash 函数来设计消息认证码，关于 Hash 函数，请去阅读单向散列函数相关的章节。原因是 Hash函数具有以下这些特征：

- 一般像 MD5, SHA-1, Blake2 这样的 Hash 函数， 其软件执行速度比诸如 DES 和 AES 这样的分组密码算法要快.
- 可利用密码 Hash 函数代码库。
- 美国或其他国家对密码 Hash 函数没有出口限制， 而对即使是用于 Mac 的对称分组密码都有出口限制。

Hash 函数不依赖于密钥, 所以不能将其直接用于 MAC。目前已经提出了许多将密钥加到 Hash 函数中的方案， 包括 UMAC 和 HMAC 等。 其中， HMAC 是目前最受欢迎的方案， 它被选为 IP 安全解决方案中实现 MAC 必须使用的方法， 并且其它 Internet 协议， 如安全套接协议 SSL 中也使用了 HMAC。下面我们会介绍几种消息认证码算法。













